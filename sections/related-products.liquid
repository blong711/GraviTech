{% comment %}
  Related Products Section
  - Uses Shopify's product recommendations or selected collection
  - Responsive carousel with Swiper
  - Configurable product display options
{% endcomment %}

{%- liquid
  assign has_recommendations = recommendations.performed
  assign recommendations_count = recommendations.products_count
  assign related_products = false
  if has_recommendations and recommendations_count > 0
    assign related_products = true
  endif
  
  if related_products
    assign products = recommendations.products
  elsif section.settings.collection != blank
    assign products = collections[section.settings.collection].products
  else
    assign products = collections.all.products
  endif
  
  assign products = products | slice: 0, section.settings.products_to_show
-%}

{%- if products.size > 0 -%}
<section class="color-{{ section.settings.color_scheme }} section-{{ section.id }}-padding">
  <div class="{{ section.settings.width }}">
    {%- if section.settings.heading != blank -%}
      <div class="flat-title wow fadeInUp">
        <h4 class="title">{{ section.settings.heading }}</h4>
      </div>
    {%- endif -%}
    
    <div class="hover-sw-nav hover-sw-2 wow fadeInUp">
      <div dir="ltr" class="swiper tf-swiper wrap-sw-over" data-swiper='{
        "slidesPerView": {{ section.settings.items_per_row_mobile }},
        "spaceBetween": 12,
        "speed": 800,
        "observer": true,
        "observeParents": true,
        "slidesPerGroup": {{ section.settings.items_per_row_mobile }},
        "navigation": {
          "clickable": true,
          "nextEl": ".nav-next-bought",
          "prevEl": ".nav-prev-bought"
        },
        "pagination": { "el": ".sw-pagination-bought", "clickable": true },
        "breakpoints": {
          "768": { 
            "slidesPerView": {{ section.settings.items_per_row_tablet }}, 
            "spaceBetween": 12, 
            "slidesPerGroup": {{ section.settings.items_per_row_tablet }} 
          },
          "1200": { 
            "slidesPerView": {{ section.settings.items_per_row_desktop }}, 
            "spaceBetween": 24, 
            "slidesPerGroup": {{ section.settings.items_per_row_desktop }}
          }
        }
      }'>
        <div class="swiper-wrapper">
          {%- for product in products -%}
            <div class="swiper-slide">
              {% render 'product-card', product: product %}
            </div>
          {%- endfor -%}
        </div>
        
        {%- if section.settings.show_mobile_dots -%}
          <div class="d-flex d-xl-none sw-dot-default sw-pagination-bought justify-content-center"></div>
        {%- endif -%}
      </div>
      
      {%- if section.settings.show_navigation -%}
        <div class="d-none d-xl-flex swiper-button-next nav-swiper nav-next-bought"></div>
        <div class="d-none d-xl-flex swiper-button-prev nav-swiper nav-prev-bought"></div>
      {%- endif -%}
    </div>
  </div>
</section>
{%- endif -%}
<style>
.section-{{ section.id }}-padding {
    padding-top: calc({{ section.settings.padding_top }}px * {{ section.settings.padding_mobile_rate | divided_by: 100.0 }});
    padding-bottom: calc({{ section.settings.padding_bottom }}px * {{ section.settings.padding_mobile_rate | divided_by: 100.0 }});
}
    
@media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    }
}
</style>
{% schema %}
{
  "name": "Related products",
  "settings": [
    {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "t:sections.all.colors.label",
        "default": "scheme-1"
    },
    {
        "type": "select",
        "id": "width",
        "label": "t:sections.all.width.label",
        "options": [
            {
            "value": "container",
            "label": "t:sections.all.width.options.boxed"
            },
            {
            "value": "container-full",
            "label": "t:sections.all.width.options.full_width"
            }
        ],
        "default": "container"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "People Also Bought"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 5,
      "label": "Product count"
    },
    {
        "type": "header",
        "content": "t:sections.brands.settings.slider_settings.content"
    },
    {
        "type": "checkbox",
        "id": "show_navigation",
        "label": "t:sections.brands.settings.show_arrows.label",
        "default": true
    },
    {
        "type": "checkbox",
        "id": "show_mobile_dots",
        "label": "t:sections.brands.settings.show_mobile_dots.label",
        "default": true
    },
    {
        "type": "range",
        "id": "items_per_row_desktop",
        "min": 3,
        "max": 8,
        "step": 1,
        "label": "t:sections.brands.settings.items_per_row_desktop.label",
        "default": 6
    },
    {
        "type": "range",
        "id": "items_per_row_tablet",
        "min": 2,
        "max": 6,
        "step": 1,
        "label": "t:sections.brands.settings.items_per_row_tablet.label",
        "default": 4
    },
    {
        "type": "range",
        "id": "items_per_row_mobile",
        "min": 1,
        "max": 4,
        "step": 1,
        "label": "t:sections.brands.settings.items_per_row_mobile.label",
        "default": 3
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Products from this collection will be shown if no recommendations are available"
    },
    {
        "type": "header",
        "content": "t:sections.all.padding.section_padding_heading"
    },
    {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_top",
        "default": 0
    },
    {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_bottom",
        "default": 0
    },
    {
      "type": "range",
      "id": "padding_mobile_rate",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "t:sections.top_bar.settings.padding_mobile_rate.label",
      "default": 75,
      "info": "t:sections.top_bar.settings.padding_mobile_rate.info"
    }
  ],
  "presets": [
    {
      "name": "Related products"
    }
  ]
}
{% endschema %}