{% comment %}
  Recently Viewed Products Section
  - Displays products that the customer has recently viewed
  - Uses product-card snippet for consistent styling
  - Responsive swiper carousel with navigation
{% endcomment %}

{%- liquid
  assign section_id = 'recently-viewed-' | append: section.id
  assign products_to_show = section.settings.products_to_show | default: 8
  assign show_title = section.settings.show_title | default: true
  assign title = section.settings.title | default: 'Recently Viewed'
  assign show_navigation = section.settings.show_navigation | default: true
  assign show_pagination = section.settings.show_pagination | default: true
  assign slides_per_view_mobile = section.settings.slides_per_view_mobile | default: 2
  assign slides_per_view_tablet = section.settings.slides_per_view_tablet | default: 3
  assign slides_per_view_desktop = section.settings.slides_per_view_desktop | default: 4
  assign space_between = section.settings.space_between | default: 12
  assign space_between_desktop = section.settings.space_between_desktop | default: 24
-%}

{%- comment -%}Get recently viewed products from localStorage or session{%- endcomment -%}
{%- assign recently_viewed_products = blank -%}

{%- comment -%}For demo purposes, we'll use a collection or featured products{%- endcomment -%}
{%- if section.settings.collection != blank -%}
  {%- assign recently_viewed_products = collections[section.settings.collection].products -%}
{%- elsif section.settings.product_list != blank -%}
  {%- assign recently_viewed_products = section.settings.product_list -%}
{%- else -%}
  {%- assign recently_viewed_products = collections.all.products -%}
{%- endif -%}

{%- if recently_viewed_products != blank -%}
<section class="flat-spacing" id="{{ section_id }}">
    <div class="container">
        {%- if show_title -%}
        <div class="flat-title wow fadeInUp">
            <h4 class="title">{{ title }}</h4>
        </div>
        {%- endif -%}
        
        <div class="hover-sw-nav hover-sw-2 wow fadeInUp" data-products-to-show="{{ products_to_show }}">
            <div dir="ltr" class="swiper tf-swiper wrap-sw-over" data-swiper='{
                "slidesPerView": {{ slides_per_view_mobile }},
                "spaceBetween": {{ space_between }},
                "speed": 800,
                "observer": true,
                "observeParents": true,
                "slidesPerGroup": {{ slides_per_view_mobile }},
                "navigation": {
                    "clickable": true,
                    "nextEl": ".nav-next-{{ section_id }}",
                    "prevEl": ".nav-prev-{{ section_id }}"
                },
                "pagination": { "el": ".sw-pagination-{{ section_id }}", "clickable": true },
                "breakpoints": {
                    "768": { 
                        "slidesPerView": {{ slides_per_view_tablet }}, 
                        "spaceBetween": {{ space_between }}, 
                        "slidesPerGroup": {{ slides_per_view_tablet }}
                    },
                    "1200": { 
                        "slidesPerView": {{ slides_per_view_desktop }}, 
                        "spaceBetween": {{ space_between_desktop }}, 
                        "slidesPerGroup": {{ slides_per_view_desktop }}
                    }
                }
            }'>
                <div class="swiper-wrapper">
                    {%- for product in recently_viewed_products limit: products_to_show -%}
                        <div class="swiper-slide">
                        </div>
                    {%- endfor -%}
                </div>
                
                {%- if show_pagination -%}
                <div class="d-flex d-xl-none sw-dot-default sw-pagination-{{ section_id }} justify-content-center"></div>
                {%- endif -%}
            </div>
            
            {%- if show_navigation -%}
            <div class="d-none d-xl-flex swiper-button-next nav-swiper nav-next-{{ section_id }}"></div>
            <div class="d-none d-xl-flex swiper-button-prev nav-swiper nav-prev-{{ section_id }}"></div>
            {%- endif -%}
        </div>
    </div>
</section>

{%- endif -%}

{% schema %}
{
  "name": "Recently Viewed",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Recently Viewed"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Show Section Title",
      "default": true
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 8,
      "label": "Number of Products to Show"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection (fallback if no recently viewed products)"
    },
    {
      "type": "product_list",
      "id": "product_list",
      "label": "Product List (fallback if no recently viewed products)"
    },
    {
      "type": "range",
      "id": "slides_per_view_mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 2,
      "label": "Slides Per View (Mobile)"
    },
    {
      "type": "range",
      "id": "slides_per_view_tablet",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3,
      "label": "Slides Per View (Tablet)"
    },
    {
      "type": "range",
      "id": "slides_per_view_desktop",
      "min": 3,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "Slides Per View (Desktop)"
    },
    {
      "type": "range",
      "id": "space_between",
      "min": 8,
      "max": 32,
      "step": 4,
      "default": 12,
      "label": "Space Between Slides (Mobile/Tablet)"
    },
    {
      "type": "range",
      "id": "space_between_desktop",
      "min": 16,
      "max": 48,
      "step": 4,
      "default": 24,
      "label": "Space Between Slides (Desktop)"
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show Navigation Arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "label": "Show Pagination Dots",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Product Vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show Product Rating",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "label": "Show Quick Add Button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_quick_view",
      "label": "Show Quick View Button",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Recently Viewed"
    }
  ]
}
{% endschema %}