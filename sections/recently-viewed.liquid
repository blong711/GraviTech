{% comment %}
  Recently Viewed Products Section
  - Displays products that the customer has recently viewed
  - Uses product-card snippet for consistent styling
  - Responsive swiper carousel with navigation
{% endcomment %}

{%- liquid
  assign section_id = 'recently-viewed-' | append: section.id
-%}

{%- comment -%}Get recently viewed products from localStorage or session{%- endcomment -%}
{%- assign recently_viewed_products = blank -%}

{%- comment -%}For demo purposes, we'll use all products{%- endcomment -%}
{%- assign recently_viewed_products = collections.all.products -%}

{%- if recently_viewed_products != blank -%}
<section class="flat-spacing color-{{ section.settings.color_scheme }} section-{{ section.id }}-padding" id="{{ section_id }}">
    <div class="{{ section.settings.width }}">
        {%- if section.settings.show_title -%}
        <div class="flat-title wow fadeInUp">
            <h4 class="title">{{ section.settings.title }}</h4>
        </div>
        {%- endif -%}
        
        <div class="hover-sw-nav hover-sw-2 wow fadeInUp" data-products-to-show="{{ section.settings.products_to_show }}">
            <div dir="ltr" class="swiper tf-swiper wrap-sw-over" data-swiper='{
                "slidesPerView": {{ section.settings.slides_per_view_mobile }},
                "spaceBetween": {{ section.settings.space_between }},
                "speed": 800,
                "observer": true,
                "observeParents": true,
                "slidesPerGroup": {{ section.settings.slides_per_view_mobile }},
                "navigation": {
                    "clickable": true,
                    "nextEl": ".nav-next-{{ section_id }}",
                    "prevEl": ".nav-prev-{{ section_id }}"
                },
                "pagination": { "el": ".sw-pagination-{{ section_id }}", "clickable": true },
                "breakpoints": {
                    "768": { 
                        "slidesPerView": {{ section.settings.slides_per_view_tablet }}, 
                        "spaceBetween": {{ section.settings.space_between }}, 
                        "slidesPerGroup": {{ section.settings.slides_per_view_tablet }}
                    },
                    "1200": { 
                        "slidesPerView": {{ section.settings.slides_per_view_desktop }}, 
                        "spaceBetween": {{ section.settings.space_between_desktop }}, 
                        "slidesPerGroup": {{ section.settings.slides_per_view_desktop }}
                    }
                }
            }'>
                <div class="swiper-wrapper">
                    {%- for product in recently_viewed_products limit: section.settings.products_to_show -%}
                        <div class="swiper-slide">
                        </div>
                    {%- endfor -%}
                </div>
                
                {%- if section.settings.show_pagination -%}
                <div class="d-flex d-xl-none sw-dot-default sw-pagination-{{ section_id }} justify-content-center"></div>
                {%- endif -%}
            </div>
            
            {%- if section.settings.show_navigation -%}
            <div class="d-none d-xl-flex swiper-button-next nav-swiper nav-next-{{ section_id }}"></div>
            <div class="d-none d-xl-flex swiper-button-prev nav-swiper nav-prev-{{ section_id }}"></div>
            {%- endif -%}
        </div>
    </div>
</section>

{%- endif -%}
<style>
.section-{{ section.id }}-padding {
    padding-top: calc({{ section.settings.padding_top }}px * {{ section.settings.padding_mobile_rate | divided_by: 100.0 }});
    padding-bottom: calc({{ section.settings.padding_bottom }}px * {{ section.settings.padding_mobile_rate | divided_by: 100.0 }});
}
    
@media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    }
}
</style>
{% schema %}
{
  "name": "t:sections.recently-viewed.name",
  "tag": "section",
  "class": "section",
  "settings": [
    {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "t:sections.all.colors.label",
        "default": "scheme-1"
    },
    {
        "type": "select",
        "id": "width",
        "label": "t:sections.all.width.label",
        "options": [
            {
            "value": "container",
            "label": "t:sections.all.width.options.boxed"
            },
            {
            "value": "container-full",
            "label": "t:sections.all.width.options.full_width"
            }
        ],
        "default": "container"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "t:sections.recently-viewed.settings.show_title.label",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.recently-viewed.settings.title.label",
      "default": "Recently Viewed"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 8,
      "label": "t:sections.recently-viewed.settings.products_to_show.label"
    },

    {
      "type": "range",
      "id": "slides_per_view_mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 2,
      "label": "t:sections.recently-viewed.settings.slides_per_view_mobile.label"
    },
    {
      "type": "range",
      "id": "slides_per_view_tablet",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3,
      "label": "t:sections.recently-viewed.settings.slides_per_view_tablet.label"
    },
    {
      "type": "range",
      "id": "slides_per_view_desktop",
      "min": 3,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "t:sections.recently-viewed.settings.slides_per_view_desktop.label"
    },
    {
      "type": "range",
      "id": "space_between",
      "min": 8,
      "max": 32,
      "step": 4,
      "default": 12,
      "label": "t:sections.recently-viewed.settings.space_between.label"
    },
    {
      "type": "range",
      "id": "space_between_desktop",
      "min": 16,
      "max": 48,
      "step": 4,
      "default": 24,
      "label": "t:sections.recently-viewed.settings.space_between_desktop.label"
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "t:sections.recently-viewed.settings.show_navigation.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "label": "t:sections.recently-viewed.settings.show_pagination.label",
      "default": true
    },
    {
        "type": "header",
        "content": "t:sections.all.padding.section_padding_heading"
    },
    {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_top",
        "default": 0
    },
    {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_bottom",
        "default": 0
    },
    {
      "type": "range",
      "id": "padding_mobile_rate",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "t:sections.all.padding.padding_mobile_rate.label",
      "default": 75,
      "info": "t:sections.all.padding.padding_mobile_rate.info"
    }
  ],
  "presets": [
    {
      "name": "t:sections.recently-viewed.name"
    }
  ]
}
{% endschema %}