{% schema %}
{
  "name": "t:sections.main_slider.name",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "select",
      "id": "width",
      "label": "t:sections.main_slider.settings.width.label",
      "options": [
        {
          "value": "container",
          "label": "t:sections.main_slider.settings.width.options.boxed"
        },
        {
          "value": "container-full",
          "label": "t:sections.main_slider.settings.width.options.full_width"
        }
      ],
      "default": "container"
    },
    {
      "type": "select",
      "id": "height",
      "label": "t:sections.main_slider.settings.height.label",
      "options": [
        {
          "value": "adapt",
          "label": "t:sections.main_slider.settings.height.options.adapt"
        },
        {
          "value": "adapt-first",
          "label": "t:sections.main_slider.settings.height.options.adapt_first"
        },
        {
          "value": "fill",
          "label": "t:sections.main_slider.settings.height.options.fill"
        },
        {
          "value": "fixed",
          "label": "t:sections.main_slider.settings.height.options.fixed"
        }
      ],
      "default": "adapt"
    },
    {
      "type": "range",
      "id": "height_fixed",
      "label": "t:sections.main_slider.settings.height_fixed.label",
      "min": 100,
      "max": 1000,
      "step": 10,
      "unit": "px",
      "default": 500,
      "info": "t:sections.main_slider.settings.height_fixed.info"
    },
    {
      "type": "select",
      "id": "mobile_height",
      "label": "t:sections.main_slider.settings.mobile_height.label",
      "options": [
        {
          "value": "adapt",
          "label": "t:sections.main_slider.settings.mobile_height.options.adapt"
        },
        {
          "value": "fixed",
          "label": "t:sections.main_slider.settings.mobile_height.options.fixed"
        }
      ],
      "default": "adapt"
    },
    {
      "type": "range",
      "id": "mobile_height_fixed",
      "label": "t:sections.main_slider.settings.mobile_height_fixed.label",
      "min": 100,
      "max": 800,
      "step": 10,
      "unit": "px",
      "default": 300,
      "info": "t:sections.main_slider.settings.mobile_height_fixed.info"
    },
    {
      "type": "header",
      "content": "t:sections.main_slider.settings.slider_settings.content"
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "t:sections.main_slider.settings.loop.label",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "t:sections.main_slider.settings.autoplay_speed.label",
      "min": 0,
      "max": 10,
      "step": 0.5,
      "default": 5,
      "info": "t:sections.main_slider.settings.autoplay_speed.info"
    },
    {
      "type": "checkbox",
      "id": "pause_on_hover",
      "label": "t:sections.main_slider.settings.pause_on_hover.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "draggable",
      "label": "t:sections.main_slider.settings.draggable.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "t:sections.main_slider.settings.show_arrows.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_arrows_mobile",
      "label": "t:sections.main_slider.settings.show_arrows_mobile.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "t:sections.main_slider.settings.show_dots.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_mobile_rate",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "t:sections.top_bar.settings.padding_mobile_rate.label",
      "default": 75,
      "info": "t:sections.top_bar.settings.padding_mobile_rate.info"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "t:sections.main_slider.blocks.slide.name",
      "limit": 5,
      "settings": [
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "label": "t:sections.all.colors.label"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.main_slider.blocks.slide.settings.image.label"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "t:sections.main_slider.blocks.slide.settings.mobile_image.label",
          "info": "t:sections.main_slider.blocks.slide.settings.mobile_image.info"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.main_slider.blocks.slide.settings.heading.label",
          "default": "t:sections.main_slider.blocks.slide.settings.heading.default"
        },
        {
          "type": "select",
          "id": "heading_size",
          "label": "t:sections.main_slider.blocks.slide.settings.heading_size.label",
          "options": [
            {
              "value": "display-sm",
              "label": "t:sections.main_slider.blocks.slide.settings.heading_size.options.small"
            },
            {
              "value": "display-md",
              "label": "t:sections.main_slider.blocks.slide.settings.heading_size.options.medium"
            },
            {
              "value": "display-lg",
              "label": "t:sections.main_slider.blocks.slide.settings.heading_size.options.large"
            }
          ],
          "default": "display-md"
        },
        {
          "type": "select",
          "id": "heading_weight",
          "label": "t:sections.main_slider.blocks.slide.settings.heading_weight.label",
          "options": [
            {
              "value": "fw-normal",
              "label": "t:sections.main_slider.blocks.slide.settings.heading_weight.options.normal"
            },
            {
              "value": "fw-medium",
              "label": "t:sections.main_slider.blocks.slide.settings.heading_weight.options.medium"
            },
            {
              "value": "fw-semibold",
              "label": "t:sections.main_slider.blocks.slide.settings.heading_weight.options.semi_bold"
            },
            {
              "value": "fw-bold",
              "label": "t:sections.main_slider.blocks.slide.settings.heading_weight.options.bold"
            }
          ],
          "default": "fw-medium"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "t:sections.main_slider.blocks.slide.settings.description.label",
          "default": "t:sections.main_slider.blocks.slide.settings.description.default"
        },
        {
          "type": "select",
          "id": "content_alignment",
          "label": "t:sections.main_slider.blocks.slide.settings.content_alignment.label",
          "options": [
            {
              "value": "col-12 col-sm-6 col-lg-5",
              "label": "t:sections.main_slider.blocks.slide.settings.content_alignment.options.left"
            },
            {
              "value": "col-12 col-sm-8 col-lg-6 offset-sm-2 offset-lg-3",
              "label": "t:sections.main_slider.blocks.slide.settings.content_alignment.options.center"
            },
            {
              "value": "col-12 col-sm-6 col-lg-5 offset-sm-6 offset-lg-6",
              "label": "t:sections.main_slider.blocks.slide.settings.content_alignment.options.right"
            }
          ],
          "default": "col-12 col-sm-6 col-lg-5"
        },
        {
          "type": "radio",
          "id": "text_size",
          "label": "t:sections.main_slider.blocks.slide.settings.text_size.label",
          "options": [
            {
              "value": "text-sm",
              "label": "t:sections.main_slider.blocks.slide.settings.text_size.options.small"
            },
            {
              "value": "text-md",
              "label": "t:sections.main_slider.blocks.slide.settings.text_size.options.medium"
            },
            {
              "value": "text-lg",
              "label": "t:sections.main_slider.blocks.slide.settings.text_size.options.large"
            }
          ],
          "default": "text-md"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "t:sections.main_slider.blocks.slide.settings.button_link.label"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "t:sections.main_slider.blocks.slide.settings.button_text.label",
          "default": "t:sections.main_slider.blocks.slide.settings.button_text.default"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.main_slider.presets.name",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}

{% style %}
  .slider-height {
    {% if section.settings.height == 'fixed' %}
      height: {{ section.settings.height_fixed }}px;
    {% elsif section.settings.height == 'fill' %}
      height: 100vh;
    {% elsif section.settings.height == 'adapt' %}
      height: auto; /* each slide adapts */
    {% elsif section.settings.height == 'adapt-first' %}
      height: auto; /* will be locked to first image by JS */
    {% endif %}
  }
  
  @media (max-width: 767px) {
    .slider-height {
      {% if section.settings.mobile_height == 'fixed' %}
        height: {{ section.settings.mobile_height_fixed }}px;
      {% elsif section.settings.mobile_height == 'adapt' %}
        height: auto;
      {% endif %}
    }
  }
  
  .section-{{ section.id }}-padding {
    padding-top: calc({{ section.settings.padding_top }}px * {{ section.settings.padding_mobile_rate | divided_by: 100.0 }});
    padding-bottom: calc({{ section.settings.padding_bottom }}px * {{ section.settings.padding_mobile_rate | divided_by: 100.0 }});
  }
  
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
  {% endstyle %}
  

<section class="tf-slideshow slider-electric-access slider-default color-{{ section.settings.color_scheme }} gradient section-{{ section.id }}-padding">
    <div class="{{ section.settings.width }}">
        <div class="row">
            <div class="col-lg-12">
                <div class="swiper tf-sw-slideshow slider-effect-fade slider-height" 
                    data-slider-id="{{ section.id }}"
                    data-height="{{ section.settings.height }}"
                    data-preview="1" 
                    data-tablet="1"
                    data-mobile="1" 
                    data-centered="false" 
                    data-space="0" 
                    data-space-mb="0" 
                    data-loop="{{ section.settings.loop }}"
                    {% assign autoplay_ms = section.settings.autoplay_speed | times: 1000 %}
                    data-auto-play="{% if autoplay_ms > 0 %}true{% else %}false{% endif %}"
                    data-delay="{{ autoplay_ms }}"
                    data-simulate-touch="{{ section.settings.draggable }}"
                    data-pause-on-hover="{{ section.settings.pause_on_hover }}">
                    <div class="swiper-wrapper">
                        {% for block in section.blocks %}
                            {% if block.type == 'slide' %}
                                <div class="swiper-slide color-{{ block.settings.color_scheme | default: section.settings.color_scheme }} gradient" {{ block.shopify_attributes }}>
                                    <div class="slider-wrap">
                                        <div class="image">
                                                                                            {% if block.settings.image %}
                                                {% assign image_class = 'lazyload' %}
                                                {% if section.settings.height == 'fill' or section.settings.height == 'fixed' %}
                                                    {% assign image_class = image_class | append: ' w-100 h-100 object-fit-cover' %}
                                                {% endif %}
                                                
                                                {% assign desktop_image_class = image_class | append: ' d-none d-md-block' %}
                                                {% assign mobile_image_class = image_class | append: ' d-md-none' %}
                                                
                                                {{ block.settings.image | image_url: width: 1920 | image_tag: 
                                                    loading: 'lazy',
                                                    class: desktop_image_class,
                                                    alt: block.settings.heading
                                                }}

                                                {% if block.settings.mobile_image %}
                                                    {{ block.settings.mobile_image | image_url: width: 767 | image_tag: 
                                                        loading: 'lazy',
                                                        class: mobile_image_class,
                                                        alt: block.settings.heading
                                                    }}
                                                {% else %}
                                                    {{ block.settings.image | image_url: width: 767 | image_tag: 
                                                        loading: 'lazy',
                                                        class: mobile_image_class,
                                                        alt: block.settings.heading
                                                    }}
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                        <div class="box-content">
                                            <div class="container">
                                                <div class="row">
                                                    <div class="{{ block.settings.content_alignment }}">
                                                        <div class="content-slider">
                                                            <div class="box-title-slider">
                                                                <h4 class="heading {{ block.settings.heading_size }} {{ block.settings.heading_weight }} fade-item fade-item-1">
                                                                    {{ block.settings.heading }}
                                                                </h4>
                                                                <p class="sub {{ block.settings.text_size }} fade-item fade-item-2" style="color: rgb(var(--color-foreground2));">
                                                                    {{ block.settings.description }}
                                                                </p>
                                                            </div>
                                                            {% if block.settings.button_link %}
                                                                <div class="box-btn-slider fade-item fade-item-3">
                                                                    <a href="{{ block.settings.button_link }}"
                                                                        class="tf-btn animate-btn">
                                                                        {{ block.settings.button_text }}
                                                                    </a>
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% if section.settings.show_arrows or section.settings.show_arrows_mobile %}
                      <div class="navigation-next-slider swiper-button-next {% unless section.settings.show_arrows_mobile %}d-none d-md-block{% endunless %} {% unless section.settings.show_arrows %}d-block d-md-none{% endunless %}"></div>
                      <div class="navigation-prev-slider swiper-button-prev {% unless section.settings.show_arrows_mobile %}d-none d-md-block{% endunless %} {% unless section.settings.show_arrows %}d-block d-md-none{% endunless %}"></div>
                    {% endif %}

                    {% if section.settings.show_dots %}
                        <div class="wrap-pagination">
                            <div class="container">
                                <div class="sw-dots style-dark sw-pagination-slider justify-content-center"></div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const slider = document.querySelector('[data-slider-id="{{ section.id }}"]');
    if (!slider) return;
  
    if (slider.dataset.height === "adapt-first") {
      // Get the first slide
      const firstSlide = slider.querySelector(".swiper-slide");
      if (firstSlide) {
        // Get the desktop image from the first slide (or fallback to any image)
        const firstImg = firstSlide.querySelector(".d-none.d-md-block img") || 
                        firstSlide.querySelector("img");
        
        if (firstImg) {
          const setHeight = () => {
            const imgHeight = firstImg.offsetHeight;
            if (imgHeight > 0) {
              slider.style.height = imgHeight + "px";
            }
          };

          if (firstImg.complete) {
            setHeight();
          } else {
            firstImg.onload = setHeight;
          }

          window.addEventListener("resize", setHeight);
        }
      }
    }
  });
</script>
  