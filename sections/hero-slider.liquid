{% comment %}
  Hero Slider Section
  Tạo slider với nhiều slides, auto-play và dots navigation
{% endcomment %}

{% render 'hero-slider-gradients' %}

{% stylesheet %}
  .hero-slider {
    position: relative;
    width: 100%;
    height: 793px;
    overflow: hidden;
    border-radius: 0;
  }

  .hero-slider__wrapper {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .hero-slider__slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.6s ease-in-out;
    display: flex;
    align-items: center;
  }

  .hero-slider__slide.active {
    opacity: 1;
  }

  .hero-slider__background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  .hero-slider__image {
    position: absolute;
    right: 0;
    top: 0;
    width: 55%;
    height: 100%;
    z-index: 2;
  }

  .hero-slider__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .hero-slider__content {
    position: relative;
    z-index: 3;
    padding: 0 240px 0 240px;
    max-width: 668px;
    color: #252525;
  }

  .hero-slider__title {
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    font-size: 64px;
    line-height: 1.15625;
    text-transform: uppercase;
    margin-bottom: 32px;
    color: inherit;
  }

  .hero-slider__description {
    font-family: 'DM Sans', sans-serif;
    font-weight: 400;
    font-size: 16px;
    line-height: 1.625;
    color: #494949;
    margin-bottom: 48px;
  }

  .hero-slider__button {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 13px 32px;
    background-color: #6a3d2d;
    color: #ffffff;
    border: none;
    border-radius: 40px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 16px;
    line-height: 1.625;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .hero-slider__button:hover {
    background-color: #5a342a;
    transform: translateY(-2px);
  }

  .hero-slider__button-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .hero-slider__button-icon svg {
    width: 21px;
    height: 9px;
    fill: currentColor;
  }

  .hero-slider__dots {
    position: absolute;
    bottom: 46px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 16px;
    z-index: 4;
  }

  .hero-slider__dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #8e8e8e;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    padding: 0;
  }

  .hero-slider__dot.active {
    width: 22px;
    height: 22px;
    background-color: transparent;
    border: 1px solid #252525;
    position: relative;
  }

  .hero-slider__dot.active::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background-color: #252525;
    border-radius: 50%;
  }

  /* Responsive Design */
  @media screen and (max-width: 1200px) {
    .hero-slider__content {
      padding: 0 120px 0 120px;
    }

    .hero-slider__title {
      font-size: 48px;
    }
  }

  @media screen and (max-width: 768px) {
    .hero-slider {
      height: 600px;
    }

    .hero-slider__slide {
      flex-direction: column;
      text-align: center;
    }

    .hero-slider__image {
      position: relative;
      width: 100%;
      height: 50%;
      right: auto;
      top: auto;
    }

    .hero-slider__content {
      padding: 40px 20px;
      max-width: 100%;
      width: 100%;
    }

    .hero-slider__title {
      font-size: 32px;
      margin-bottom: 24px;
    }

    .hero-slider__description {
      font-size: 14px;
      margin-bottom: 32px;
    }
  }

  @media screen and (max-width: 480px) {
    .hero-slider {
      height: 500px;
    }

    .hero-slider__title {
      font-size: 24px;
    }

    .hero-slider__content {
      padding: 20px 16px;
    }
  }
{% endstylesheet %}

<div
  class="hero-slider"
  data-hero-slider
  data-autoplay-delay="{{ section.settings.autoplay_delay | default: 5000 }}"
  data-enable-autoplay="{{ section.settings.enable_autoplay | default: true }}"
>
  <div class="hero-slider__wrapper">
    {% for block in section.blocks %}
      <div
        class="hero-slider__slide{% if forloop.first %} active{% endif %}"
        data-slide-index="{{ forloop.index0 }}"
        style="--bg-color: {{ block.settings.background_color }};"
      >
        {%- comment -%} Background {%- endcomment -%}
        {% assign bg_style = '' %}
        {% if block.settings.background_type == 'gradient' %}
          {% assign bg_style = 'background: ' | append: block.settings.gradient_background %}
        {% elsif block.settings.background_color != blank %}
          {% assign bg_style = 'background-color: ' | append: block.settings.background_color %}
        {% else %}
          {% assign bg_style = 'background: linear-gradient(270deg, rgba(255, 218, 246, 1) 0%, rgba(237, 255, 218, 1) 100%)' %}
        {% endif %}

        <div class="hero-slider__background" style="{{ bg_style }};"></div>

        {%- comment -%} Content {%- endcomment -%}
        <div class="hero-slider__content">
          {% if block.settings.title != blank %}
            <h1 class="hero-slider__title">{{ block.settings.title }}</h1>
          {% endif %}

          {% if block.settings.description != blank %}
            <p class="hero-slider__description">{{ block.settings.description }}</p>
          {% endif %}

          {% if block.settings.button_text != blank and block.settings.button_link != blank %}
            <a href="{{ block.settings.button_link }}" class="hero-slider__button">
              {{ block.settings.button_text }}
              <span class="hero-slider__button-icon">
                <svg viewBox="0 0 21 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20.3536 4.85355C20.5488 4.65829 20.5488 4.34171 20.3536 4.14645L17.1716 0.964466C16.9763 0.769204 16.6597 0.769204 16.4645 0.964466C16.2692 1.15973 16.2692 1.47631 16.4645 1.67157L19.2929 4.5L16.4645 7.32843C16.2692 7.52369 16.2692 7.84027 16.4645 8.03553C16.6597 8.2308 16.9763 8.2308 17.1716 8.03553L20.3536 4.85355ZM0 5H20V4H0V5Z" fill="currentColor"/>
                </svg>
              </span>
            </a>
          {% endif %}
        </div>

        {%- comment -%} Image {%- endcomment -%}
        {% if block.settings.image != blank %}
          <div class="hero-slider__image">
            <img
              src="{{ block.settings.image | image_url: width: 1061 }}"
              alt="{{ block.settings.image.alt | default: block.settings.title }}"
              width="1061"
              height="782"
              loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
            >
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  {%- comment -%} Dots Navigation {%- endcomment -%}
  {% if section.blocks.size > 1 %}
    <div class="hero-slider__dots">
      {% for block in section.blocks %}
        <button
          class="hero-slider__dot{% if forloop.first %} active{% endif %}"
          data-slide-to="{{ forloop.index0 }}"
          aria-label="Go to slide {{ forloop.index }}"
        ></button>
      {% endfor %}
    </div>
  {% endif %}
</div>

{% javascript %}
  class HeroSlider {
    constructor(element) {
      this.slider = element;
      this.slides = this.slider.querySelectorAll('.hero-slider__slide');
      this.dots = this.slider.querySelectorAll('.hero-slider__dot');
      this.currentIndex = 0;
      this.autoPlayInterval = null;
      this.autoPlayDelay = parseInt(this.slider.dataset.autoplayDelay) || 5000;
      this.isAutoPlay = this.slider.dataset.enableAutoplay === 'true';

      this.init();
    }

    init() {
      this.bindEvents();
      if (this.isAutoPlay && this.slides.length > 1) {
        this.startAutoPlay();
      }
    }

    bindEvents() {
      // Dots navigation
      this.dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
          this.goToSlide(index);
          this.stopAutoPlay();
          if (this.isAutoPlay) {
            this.startAutoPlay();
          }
        });
      });

      // Pause autoplay on hover
      this.slider.addEventListener('mouseenter', () => {
        this.stopAutoPlay();
      });

      this.slider.addEventListener('mouseleave', () => {
        if (this.isAutoPlay && this.slides.length > 1) {
          this.startAutoPlay();
        }
      });

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          this.prevSlide();
        } else if (e.key === 'ArrowRight') {
          this.nextSlide();
        }
      });
    }

    goToSlide(index) {
      if (index === this.currentIndex) return;

      // Remove active class from current slide and dot
      this.slides[this.currentIndex].classList.remove('active');
      if (this.dots[this.currentIndex]) {
        this.dots[this.currentIndex].classList.remove('active');
      }

      // Add active class to new slide and dot
      this.currentIndex = index;
      this.slides[this.currentIndex].classList.add('active');
      if (this.dots[this.currentIndex]) {
        this.dots[this.currentIndex].classList.add('active');
      }
    }

    nextSlide() {
      const nextIndex = (this.currentIndex + 1) % this.slides.length;
      this.goToSlide(nextIndex);
    }

    prevSlide() {
      const prevIndex = (this.currentIndex - 1 + this.slides.length) % this.slides.length;
      this.goToSlide(prevIndex);
    }

    startAutoPlay() {
      this.stopAutoPlay(); // Clear any existing interval
      if (this.slides.length > 1) {
        this.autoPlayInterval = setInterval(() => {
          this.nextSlide();
        }, this.autoPlayDelay);
      }
    }

    stopAutoPlay() {
      if (this.autoPlayInterval) {
        clearInterval(this.autoPlayInterval);
        this.autoPlayInterval = null;
      }
    }
  }

  // Initialize slider when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    const heroSlider = document.querySelector('[data-hero-slider]');
    if (heroSlider) {
      new HeroSlider(heroSlider);
    }
  });

  // Reinitialize on theme editor changes
  document.addEventListener('shopify:section:load', (event) => {
    const heroSlider = event.target.querySelector('[data-hero-slider]');
    if (heroSlider) {
      new HeroSlider(heroSlider);
    }
  });
{% endjavascript %}

{% schema %}
{
  "name": "Hero Slider",
  "tag": "section",
  "class": "hero-slider-section",
  "settings": [
    {
      "type": "header",
      "content": "Slider Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "Enable autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_delay",
      "label": "Autoplay delay (milliseconds)",
      "min": 2000,
      "max": 9500,
      "step": 500,
      "default": 5000,
      "info": "Time between slide transitions when autoplay is enabled"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Care Beyond Beauty"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Nourishing products for skin, hair, and self-confidence."
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Shop Now & Shine"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "header",
          "content": "Media"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Slide image"
        },
        {
          "type": "header",
          "content": "Background"
        },
        {
          "type": "select",
          "id": "background_type",
          "label": "Background type",
          "default": "color",
          "options": [
            {
              "value": "color",
              "label": "Solid color"
            },
            {
              "value": "gradient",
              "label": "Gradient"
            }
          ]
        },
        {
          "type": "color",
          "id": "background_color",
          "label": "Background color",
          "default": "#FFDAF6"
        },
        {
          "type": "text",
          "id": "gradient_background",
          "label": "Gradient CSS",
          "default": "linear-gradient(270deg, rgba(255, 218, 246, 1) 0%, rgba(237, 255, 218, 1) 100%)",
          "info": "Enter CSS gradient value (e.g., linear-gradient(270deg, #color1 0%, #color2 100%))"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Slider",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "title": "Care Beyond Beauty",
            "description": "Nourishing products for skin, hair, and self-confidence.",
            "button_text": "Shop Now & Shine",
            "background_type": "gradient",
            "gradient_background": "linear-gradient(270deg, rgba(255, 218, 246, 1) 0%, rgba(237, 255, 218, 1) 100%)"
          }
        },
        {
          "type": "slide",
          "settings": {
            "title": "Natural Beauty",
            "description": "Discover the power of natural ingredients for your skincare routine.",
            "button_text": "Explore Collection",
            "background_type": "gradient",
            "gradient_background": "linear-gradient(270deg, rgba(218, 255, 236, 1) 0%, rgba(255, 218, 218, 1) 100%)"
          }
        },
        {
          "type": "slide",
          "settings": {
            "title": "Radiant Skin",
            "description": "Transform your skin with our premium skincare solutions.",
            "button_text": "Start Journey",
            "background_type": "gradient",
            "gradient_background": "linear-gradient(270deg, rgba(255, 240, 218, 1) 0%, rgba(218, 236, 255, 1) 100%)"
          }
        }
      ]
    }
  ]
}
{% endschema %}
