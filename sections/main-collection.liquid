{% comment %} Settings {% endcomment %}
{% assign max_products_per_page = section.settings.max_products_per_page | default: 8 %}
{% assign pagination_type = section.settings.pagination_type | default: 'pagination' %}

{% paginate collection.products by max_products_per_page %}

<section class="flat-spacing pt-0">
    <div class="container">
        <div class="tf-shop-control">
            <div class="tf-group-filter">
                <a href="#filterShop" data-bs-toggle="offcanvas" aria-controls="filterShop"
                    class="tf-btn-filter">
                    <span class="icon icon-filter"></span><span class="text">Filter</span></a>
                <div class="tf-dropdown-sort" data-bs-toggle="dropdown">
                    <div class="btn-select">
                        <span class="text-sort-value">Best selling</span>
                        <span class="icon icon-arr-down"></span>
                    </div>
                    <div class="dropdown-menu">
                        <div class="select-item active" data-sort-value="best-selling">
                            <span class="text-value-item">Best selling</span>
                        </div>
                        <div class="select-item" data-sort-value="a-z">
                            <span class="text-value-item">Alphabetically, A-Z</span>
                        </div>
                        <div class="select-item" data-sort-value="z-a">
                            <span class="text-value-item">Alphabetically, Z-A</span>
                        </div>
                        <div class="select-item" data-sort-value="price-low-high">
                            <span class="text-value-item">Price, low to high</span>
                        </div>
                        <div class="select-item" data-sort-value="price-high-low">
                            <span class="text-value-item">Price, high to low</span>
                        </div>
                    </div>
                </div>
            </div>
            <ul class="tf-control-layout">
                <li class="tf-view-layout-switch sw-layout-list list-layout" data-value-layout="list">
                    <div class="item icon-list">
                        <span></span>
                        <span></span>
                    </div>
                </li>
                <li class="tf-view-layout-switch sw-layout-2" data-value-layout="tf-col-2">
                    <div class="item icon-grid-2">
                        <span></span>
                        <span></span>
                    </div>
                </li>
                <li class="tf-view-layout-switch sw-layout-3" data-value-layout="tf-col-3">
                    <div class="item icon-grid-3">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </li>
                <li class="tf-view-layout-switch sw-layout-4 active" data-value-layout="tf-col-4">
                    <div class="item icon-grid-4">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </li>
            </ul>
        </div>
        
        <div class="wrapper-control-shop">
            <div class="meta-filter-shop">
                <div id="product-count-grid" class="count-text">
                    {% if collection.products.size > 0 %}
                        <span class="count">{{ collection.products.size }}</span> Products found
                    {% else %}
                        No products found
                    {% endif %}
                </div>
                <div id="product-count-list" class="count-text">
                    {% if collection.products.size > 0 %}
                        <span class="count">{{ collection.products.size }}</span> Products found
                    {% else %}
                        No products found
                    {% endif %}
                </div>
                <div id="applied-filters"></div>
                <button id="remove-all" class="remove-all-filters" style="display: none;">
                    <i class="icon icon-close"></i> Clear all filters
                </button>
            </div>
            
            {% comment %} List Layout {% endcomment %}
            <div class="tf-list-layout wrapper-shop" id="listLayout" style="display: none;">
                {% if collection.products.size > 0 %}
                    {% for product in collection.products %}
                        {% render 'product-card-list', product: product %}
                    {% endfor %}
                    
                    {% comment %} Pagination or Load More {% endcomment %}
                    {% if pagination_type == 'pagination' %}
                        {% if paginate.pages > 1 %}
                            <ul class="wg-pagination">
                                {% if paginate.previous %}
                                    <li>
                                        <a href="{{ paginate.previous.url }}" class="pagination-item">
                                            <i class="icon-arr-left"></i>
                                        </a>
                                    </li>
                                {% endif %}
                                
                                {% for part in paginate.parts %}
                                    {% if part.is_link %}
                                        <li>
                                            <a href="{{ part.url }}" class="pagination-item">{{ part.title }}</a>
                                        </li>
                                    {% else %}
                                        {% if part.title == paginate.current_page %}
                                            <li class="active">
                                                <div class="pagination-item">{{ part.title }}</div>
                                            </li>
                                        {% else %}
                                            <li>
                                                <div class="pagination-item">{{ part.title }}</div>
                                            </li>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                                
                                {% if paginate.next %}
                                    <li>
                                        <a href="{{ paginate.next.url }}" class="pagination-item">
                                            <i class="icon-arr-right2"></i>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        {% endif %}
                    {% else %}
                        {% comment %} Load More Button for List Layout {% endcomment %}
                        {% if collection.products.size > max_products_per_page %}
                            <div class="wd-load d-flex justify-content-center">
                                <button id="loadMoreListBtn" class="tf-btn btn-out-line-dark2 tf-loading loadmore" 
                                        data-layout="list" 
                                        data-current-page="1" 
                                        data-max-per-page="{{ max_products_per_page }}"
                                        data-total-products="{{ collection.products.size }}">
                                    <span class="text">Load more</span>
                                    <div class="spinner-circle">
                                        <span class="spinner-circle1 spinner-child"></span>
                                        <span class="spinner-circle2 spinner-child"></span>
                                        <span class="spinner-circle3 spinner-child"></span>
                                        <span class="spinner-circle4 spinner-child"></span>
                                        <span class="spinner-circle5 spinner-child"></span>
                                        <span class="spinner-circle6 spinner-child"></span>
                                        <span class="spinner-circle7 spinner-child"></span>
                                        <span class="spinner-circle8 spinner-child"></span>
                                        <span class="spinner-circle9 spinner-child"></span>
                                    </div>
                                </button>
                            </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <p class="text-lg">No products found in this collection.</p>
                    </div>
                {% endif %}
            </div>
            
            {% comment %} Grid Layout {% endcomment %}
            <div class="wrapper-shop tf-grid-layout tf-col-4" id="gridLayout">
                {% if collection.products.size > 0 %}
                    {% for product in collection.products %}
                        {% render 'product-card', product: product %}
                    {% endfor %}
                    
                    {% comment %} Pagination or Load More {% endcomment %}
                    {% if pagination_type == 'pagination' %}
                        {% if paginate.pages > 1 %}
                            <ul class="wg-pagination">
                                {% if paginate.previous %}
                                    <li>
                                        <a href="{{ paginate.previous.url }}" class="pagination-item">
                                            <i class="icon-arr-left"></i>
                                        </a>
                                    </li>
                                {% endif %}
                                
                                {% for part in paginate.parts %}
                                    {% if part.is_link %}
                                        <li>
                                            <a href="{{ part.url }}" class="pagination-item">{{ part.title }}</a>
                                        </li>
                                    {% else %}
                                        {% if part.title == paginate.current_page %}
                                            <li class="active">
                                                <div class="pagination-item">{{ part.title }}</div>
                                            </li>
                                        {% else %}
                                            <li>
                                                <div class="pagination-item">{{ part.title }}</div>
                                            </li>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                                
                                {% if paginate.next %}
                                    <li>
                                        <a href="{{ paginate.next.url }}" class="pagination-item">
                                            <i class="icon-arr-right2"></i>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        {% endif %}
                    {% else %}
                        {% comment %} Load More Button for Grid Layout {% endcomment %}
                        {% if collection.products.size > max_products_per_page %}
                            <div class="wd-load d-flex justify-content-center">
                                <button id="loadMoreGridBtn" class="tf-btn btn-out-line-dark2 tf-loading loadmore"
                                        data-layout="grid" 
                                        data-current-page="1" 
                                        data-max-per-page="{{ max_products_per_page }}"
                                        data-total-products="{{ collection.products.size }}">
                                    <span class="text">Load more</span>
                                    <div class="spinner-circle">
                                        <span class="spinner-circle1 spinner-child"></span>
                                        <span class="spinner-circle2 spinner-child"></span>
                                        <span class="spinner-circle3 spinner-child"></span>
                                        <span class="spinner-circle4 spinner-child"></span>
                                        <span class="spinner-circle5 spinner-child"></span>
                                        <span class="spinner-circle6 spinner-child"></span>
                                        <span class="spinner-circle7 spinner-child"></span>
                                        <span class="spinner-circle8 spinner-child"></span>
                                        <span class="spinner-circle9 spinner-child"></span>
                                    </div>
                                </button>
                            </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <p class="text-lg">No products found in this collection.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<div class="flat-spacing pt-0">
    <div class="container">
        <p class="text text-md text-center">
            {{ collection.description | default: "Our collection brings you a unique blend of classic sophistication and the latest fashion trends. Whether you're looking for versatile daywear, stylish work attire, or statement pieces for special occasions, this collection has it all. Each garment is thoughtfully crafted with attention to detail, using high-quality fabrics to ensure lasting comfort and a flawless fit." }}
        </p>
        <p class="mt_12 text-md text-center">
            Looking for more? Don't miss out on our other exciting collections for 
            <a href="/collections/bags" class="text-primary text-decoration-underline fw-medium">BAGS</a> and 
            <a href="/collections/accessories" class="text-primary text-decoration-underline fw-medium">ACCESSORIES</a>.
        </p>
    </div>
</div>

{% comment %} Render the filter snippet {% endcomment %}
{% render 'collection-filters', collection: collection %}

{% comment %} Add necessary data for JavaScript {% endcomment %}
<script>
    window.collectionData = {
        totalProducts: {{ collection.products.size }},
        priceMin: {{ collection.price_min | divided_by: 100.0 | round: 0 }},
        priceMax: {{ collection.price_max | divided_by: 100.0 | round: 0 }},
        paginationType: '{{ pagination_type }}',
        maxProductsPerPage: {{ max_products_per_page }}
    };
</script>

{% endpaginate %}

{% comment %} Schema for section settings {% endcomment %}
{% schema %}
{
    "name": "Main Collection",
    "settings": [
        {
            "type": "range",
            "id": "max_products_per_page",
            "label": "Products per page",
            "min": 4,
            "max": 48,
            "step": 4,
            "default": 8,
            "info": "Number of products to display per page"
        },
        {
            "type": "select",
            "id": "pagination_type",
            "label": "Pagination type",
            "options": [
                { "value": "pagination", "label": "Pagination" },
                { "value": "load_more", "label": "Load More" }
            ],
            "default": "pagination"
        }
    ]
}
{% endschema %}