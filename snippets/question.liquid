<div class="modal modalCentered fade modal-ask-question popup-style-2" id="askQuestion">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <span class="title text-xl-2 fw-medium">{{ 'general.ask_question.title' | t }}</span>
                <span class="icon-close icon-close-popup" data-bs-dismiss="modal"></span>
            </div>
            
            {% form 'contact', class: 'form-ask-question', id: 'ask_question_form' %}
                <div class="cols mb_15 flex-md-nowrap flex-wrap">
                    <fieldset class="">
                        <div class="text">{{ 'general.ask_question.name' | t }}*</div>
                        <input type="text" 
                               class="form-control" 
                               name="contact[name]" 
                               tabindex="2" 
                               value="{{ form.name }}"
                               aria-required="true" 
                               required>
                    </fieldset>
                    <fieldset class="">
                        <div class="text">{{ 'general.ask_question.phone' | t }}</div>
                        <input type="tel" 
                               class="form-control" 
                               name="contact[phone]" 
                               tabindex="2" 
                               value="{{ form.phone }}"
                               aria-required="false">
                    </fieldset>
                </div>
                
                <fieldset class="mb_15">
                    <div class="text">{{ 'general.ask_question.email' | t }}*</div>
                    <input type="email" 
                           class="form-control" 
                           name="contact[email]" 
                           tabindex="2" 
                           value="{{ form.email }}"
                           aria-required="true" 
                           required
                           pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"
                           title="Please enter a valid email address">
                    <div class="email-error-message text-danger mt-1" style="display: none; font-size: 0.875rem;">
                        Please enter a valid email address format (e.g., user@example.com)
                    </div>
                </fieldset>
                
                <fieldset class="">
                    <div class="text">{{ 'general.ask_question.message' | t }}*</div>
                    <textarea name="contact[body]" 
                              rows="4" 
                              class="form-control" 
                              tabindex="2" 
                              aria-required="true"
                              required>{{ form.body }}</textarea>
                </fieldset>
                
                {% if form.posted_successfully? %}
                    <div class="alert alert-success mt_20">
                        {{ 'general.ask_question.success_message' | t }}
                    </div>
                {% endif %}
                
                {% if form.errors %}
                    <div class="alert alert-danger mt_20">
                        {{ 'general.ask_question.error_message' | t }}
                        <ul>
                            {% for field in form.errors %}
                                <li>{{ field | capitalize }} {{ field.errors.first }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                
                <div class="text-center">
                    <button type="submit" class="tf-btn animate-btn d-inline-flex justify-content-center">
                        <span>{{ 'general.ask_question.submit' | t }}</span>
                    </button>
                </div>
            {% endform %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const emailInput = document.querySelector('input[name="contact[email]"]');
    const emailErrorDiv = document.querySelector('.email-error-message');
    const form = document.getElementById('ask_question_form');
    
    if (emailInput && emailErrorDiv) {
        // Email validation regex pattern
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        
        function validateEmail() {
            const email = emailInput.value.trim();
            
            if (email === '') {
                emailErrorDiv.style.display = 'none';
                emailInput.classList.remove('is-invalid');
                return true;
            }
            
            if (!emailPattern.test(email)) {
                emailErrorDiv.style.display = 'block';
                emailInput.classList.add('is-invalid');
                return false;
            } else {
                emailErrorDiv.style.display = 'none';
                emailInput.classList.remove('is-invalid');
                return true;
            }
        }
        
        // Validate on input (real-time feedback)
        emailInput.addEventListener('input', validateEmail);
        
        // Validate on blur (when user leaves the field)
        emailInput.addEventListener('blur', validateEmail);
        
        // Prevent form submission if email is invalid
        form.addEventListener('submit', function(e) {
            if (!validateEmail()) {
                e.preventDefault();
                emailInput.focus();
                return false;
            }
        });
    }
});
</script>